<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.57.2" />


<title>Scraping a website and sending the contents via email - Scott&#39;s Random Data Blog</title>
<meta property="og:title" content="Scraping a website and sending the contents via email - Scott&#39;s Random Data Blog">


  <link href='/home.png' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/home.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/slee1088">GitHub</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">Scraping a website and sending the contents via email</h1>

    
    <span class="article-date">2019-06-20</span>
    

    <div class="article-content">
      


<p><strong>Some Context</strong></p>
<p>One day after work, I was messaging with a friend (who’s extremely curious about data and it’s applications and a source of great ideas) and we were talking about scraping data from the internet and what tools were currently available and most easy to learn. R and Python sprang to mind and so we deep dived into some of the packages available in those languages. Then, funnily enough, the conversation turned to VBA and crude methods such as using sendkeys and how unreliable they were.</p>
<p>So, inspired as I usually am, I got home that night, turned my PC on and decided to scrap data from a couple of websites using R.</p>
<p><em>Please always be mindful of the legality of webscraping when you webscrape, useful link <a href="https://www.datahen.com/data-crawling-get-legal-side/?utm_source=Quora&amp;utm_medium=Answers">here</a>.</em></p>
<p><strong>My Workflow</strong></p>
<ul>
<li>I would say the package widely used in R for webscraping is <a href="https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/">Rvest</a>.</li>
<li>As the link to the Rvest blog points out, using <a href="https://selectorgadget.com/">selectorgadget</a> (a Chrome extension) makes finding the content you want to extract that much easier. It is possible without it but you would have to spend countless minutes trying to locate the CSS selector you are after.</li>
</ul>
<div class="figure">
<img src="/post/2019-08-31-first-post-basic-webscraping_files/webscrap1.png" alt="Click on the content you are after and the CSS selector will appear in the selectorgadget toolbar (bottom left)." />
<p class="caption"><em>Click on the content you are after and the CSS selector will appear in the selectorgadget toolbar (bottom left).</em></p>
</div>
<ul>
<li>First step - read in the website into R.</li>
</ul>
<pre class="r"><code>efinancial_news &lt;- read_html(&quot;https://news.efinancialcareers.com/hk-en/en/news-analysis&quot;)</code></pre>
<ul>
<li>Extract all the items that are linked to the CSS selector, for the articles this would be “.mt-0 a” as per the selectorgadget above. Note that html_node will pick up the first item where the CSS selector occurs whereas html_nodes will pick up all instances. We are after all the articles, so we use the latter. html_text() will then extract the text within each of the items (html nodes). The result is an array/vector of length n (depends on how many articles there are).</li>
</ul>
<pre class="r"><code>top_news &lt;- efinancial_news %&gt;%
  html_nodes(&quot;.mt-0 a&quot;) %&gt;%
  html_text()</code></pre>
<ul>
<li>If you also want to pick up the link address to the article, then use the html_attr function with “href” as the argument.</li>
</ul>
<pre class="r"><code>top_news_links &lt;- efinancial_news %&gt;%
  html_nodes(&quot;.mt-0 a&quot;) %&gt;%
  html_attr(&quot;href&quot;)</code></pre>
<ul>
<li>The blurb for the article which is linked to a different CSS selector can also be extracted using the same steps above.</li>
</ul>
<pre class="r"><code>top_news_blurb &lt;- efinancial_news %&gt;%
  html_nodes(&quot;.article-byline+ p&quot;) %&gt;%
  html_text()</code></pre>
<ul>
<li>Now, we have three arrays/vectors of the same size, one for the article header, the link to the article and the last one containing the blurb for the article.</li>
<li>These can be combined into a single data frame and flattened out into a form that can fit into an email.</li>
</ul>
<pre class="r"><code>collated &lt;- as.data.frame(cbind(top_news,top_news_links,top_news_blurb)) %&gt;% 
  mutate(mashed=paste0(top_news,&quot; - &quot;,top_news_links,&quot; (Blurb: &quot;,top_news_blurb,&quot;)&quot;))

collated_flattened &lt;- paste(collated$mashed,collapse=&quot;\n\n&quot;)</code></pre>
<ul>
<li>We can now send an email out via R. For details on how to set up your Gmail account to sync with r, please refer to the following <a href="https://www.infoworld.com/article/3398701/how-to-send-email-from-r-and-gmail.html">link</a>.</li>
<li>To see the entire R code used, please refer <a href="https://github.com/slee1088/webscraping_email/blob/master/code.r">here</a>. If you want to send via Outlook, this is also available in the code.</li>
</ul>
<div class="figure">
<img src="/post/2019-08-31-first-post-basic-webscraping_files/webscrap2.png" alt="Screenshot of email received in Gmail." />
<p class="caption"><em>Screenshot of email received in Gmail.</em></p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

